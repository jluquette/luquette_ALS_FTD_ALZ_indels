# vim: syntax=python

scatacseq_meta = pd.read_csv('manifests/SCATACSEQ.MANIFEST')

# Not trivial to generalize because the whole set of background bigwigs
# needs to be known.
rule make_foldchange_qbed_scatacseq:
    input:
        target="enrichment/scatacseq/quantile/qbed/scatacseq___librarymerged___merged___{scatacseq_celltype}.{binsize}binsize_{nquantiles}quantiles.qbed",
        background=expand("enrichment/scatacseq/quantile/qbed/scatacseq___librarymerged___merged___{scatacseq_celltype}.{{binsize}}binsize_{{nquantiles}}quantiles.qbed",
            scatacseq_celltype=sorted(set(scatacseq_meta['celltype'])))
    output:
        qbed="enrichment/scatacseq_foldchange/quantile/qbed/scatacseq_foldchange___librarymerged___merged___{scatacseq_celltype}.{binsize}binsize_{nquantiles}quantiles.qbed"
    log:
        "enrichment/scatacseq_foldchange/quantile/qbed/scatacseq_foldchange___librarymerged___merged___{scatacseq_celltype}.{binsize}binsize_{nquantiles}quantiles.log"
    resources:
        mem_mb=8000
    script:
        "scripts/make_foldchange_qbed.R"



scrnaseq_meta = pd.read_csv('manifests/SCRNASEQ_EXPRESSION_FOLDCHANGE.MANIFEST')

# Not trivial to generalize because the whole set of background bigwigs
# needs to be known.


rule make_foldchange_qbed_scrnaseq:
    input:
        target="enrichment/scrnaseq_expression_mc08/quantile/qbed/scrnaseq___expression___combined___combined___{scrnaseq_celltype}.{binsize}binsize_{nquantiles}quantiles.qbed",
        background=expand("enrichment/scrnaseq_expression_mc08/quantile/qbed/scrnaseq___expression___combined___combined___{scrnaseq_celltype}.{{binsize}}binsize_{{nquantiles}}quantiles.qbed",
            scrnaseq_celltype=sorted(set(scrnaseq_meta['celltype'])))
    output:
        qbed="enrichment/scrnaseq_expression_mc08_foldchange/quantile/qbed/scrnaseq_foldchange___expression___combined___combined___{scrnaseq_celltype}.{binsize}binsize_{nquantiles}quantiles.qbed"
    log:
        "enrichment/scrnaseq_expression_mc08_foldchange/quantile/qbed/scrnaseq_foldchange___expression___combined___combined___{scrnaseq_celltype}.{binsize}binsize_{nquantiles}quantiles.log"
    resources:
        mem_mb=8000
    script:
        "scripts/make_foldchange_qbed.R"

